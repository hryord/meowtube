

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">  
  <meta name="description" content="necotube">  
  <meta name="keywords" content="cat">  
  <meta name="author" content="necotube">
  <meta name="copyright" content="Copyright &copy; necotube">
  <title>necotube</title>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
  <script type="text/javascript" src="js/pagetop.js"></script>
  <script type="text/javascript" src="js/tipsy.js"></script> 
  <script type="text/javascript" src="js/slider.min.js"></script>
  <script type="text/javascript" src="js/pull.out.js"></script>
  <link rel="stylesheet" type="text/css" href="css/styles.css"/>
</head>
<body id="back">


<header>
	<?php include './header.php';?>
</header>




<section class="keyvisual">
  <div id="slider">
    <img class="image" src="img/key/visual01.jpg" alt="イメージ" />
    <img class="image" src="img/key/visual02.jpg" alt="イメージ" />
    <img class="image" src="img/key/visual03.jpg" alt="イメージ" />
    <img class="image" src="img/key/visual04.jpg" alt="イメージ" />
    <img class="image" src="img/key/visual05.jpg" alt="イメージ" />
    <img class="image" src="img/key/visual06.jpg" alt="イメージ" />
  </div>		
  <hgroup>
    <h1><img src="img/common/logo.png" width="80" alt="sample logo" /></h1>
    <h2>今日も１日１猫動画。このサイトは毎日猫に関する動画を紹介します。</h2>
  </hgroup>	
</section>



<section class="social">
  <ul>
    <li><a class="south" href="url" title="Twitter"><img src="img/common/icon_twitter.gif" alt="Twitter" /></a></li>
    <li><a class="south" href="url" title="Facebook"><img src="img/common/icon_facebook.gif" alt="Facebook" /></a></li>
    <li><a class="south" href="url" title="Google+"><img src="img/common/icon_google.gif" alt="Google+" /></a></li>
    <li><a class="south" href="url" title="RSS"><img src="img/common/icon_rss.gif" alt="RSS" /></a></li>
  </ul>
</section>



<div class="wrapper">

<?php
require_once "HTTP/Request.php";
require_once dirname(__FILE__) . "./Common/DBConnection.php";
require_once dirname(__FILE__) . "./Common/Logger.php";
require_once dirname(__FILE__) . "./Common/Pager.php";

define("VIDEOS_PER_PAGE", "10");

    $db = DBConnection::get()->handle();

    $blog_post_lr = array("blog_post right", "blog_post left");

	// ページング処理
	if( isset($_GET['page']) and preg_match('/^[1-9][0-9]*$/', $_GET['page']) )
	{
		$page = (int)$_GET['page'];
	}
	else
	{
		$page = 1;
	}
	$offset = VIDEOS_PER_PAGE * ($page - 1);
    $sql = 'SELECT * FROM youtube '
    		. 'LIMIT '.$offset.','.VIDEOS_PER_PAGE;
			
    try
    {
        $stmt = $db->prepare( $sql );
        $stmt->execute();
		$count = 0;
        while( $result = $stmt->fetch(PDO::FETCH_ASSOC) )
        {
        	$count++;
?>
  <section class="<?=$blog_post_lr[$count%2];?>">
    <time datetime="<?=$result['getdate'];?>"><?=date('Y年m月d日', strtotime($result['getdate']));?></time>
    <a href="./TodaysCat.php?id=<?=$result['id'];?>"><img src="<?=$result['thumbnail'];?>" alt="thumbnail" /></a>
    <h2><a href="./TodaysCat.php?id=<?=$result['id'];?>"><?=$result['title'];?></a></h2>
    <p><?=mb_strimwidth($result['description'], 0, 150, "…", "UTF-8");?></p>
    <a href="./TodaysCat.php?id=<?=$result['id'];?>" class="text_btn">続きを読む</a>
  </section>


<?php
        }
    }
    catch( PDOException $e )
    {
        var_dump($e->getMessage());
    }
?>
</div>

<?php
	// ページングのリンク作成
	$stmt = $db->query("SELECT COUNT(*) AS count FROM youtube");
	$result = $stmt->fetch();
	$totalPages = ceil($result["count"] / VIDEOS_PER_PAGE);
?>
<div class="pagenavi">
	<?php if($page > 1) : ?>
	<a class="prev" href="?page=<?php echo $page-1;?>">&lt;</a>
	<?php endif; ?>

	<?php for( $i=1; $i<=$totalPages; $i++) : ?>
		<?php if( $i === $page):?>
		<a class="current" href="?page=<?php echo $i;?>"><?php echo $i;?></a>
		<?php else:?>
		<a class="numbers" href="?page=<?php echo $i;?>"><?php echo $i;?></a>
		<?php endif; ?>
	<?php endfor; ?>

  <?php if($page < $totalPages) : ?>
  <a class="next" href="?page=<?php echo $page+1;?>">&gt;</a>
  <?php endif; ?>

<?php
	$page_navi = new Pager("page", VIDEOS_PER_PAGE, $result["count"]);
	$page_navi->getPager();
	
?>
</div>



<footer>
	<?php include './footer.php';?>
</footer>        

</body>
</html>